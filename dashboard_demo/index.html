<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Connection Conversion Monitoring</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1.5.11/css/pico.min.css">
  <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
  <div id="toast" aria-live="polite"></div>
  <div id="app">
    <header id="topbar">
      <span class="title">Connection Conversion Monitoring</span>
      <span class="pill" id="dataset-pill">DATASET v1</span>
      <span class="pill" id="cache-pill">CACHE —</span>
      <div class="actions">
        <button type="button" id="btn-toggle-panel" class="filter-collapse-btn topbar-filter-btn" aria-label="필터 접기"><span class="filter-collapse-icon" aria-hidden="true">▼</span> 필터 접기</button>
        <button type="button" id="btn-expand-filter" class="filter-collapse-btn topbar-filter-btn" style="display:none;" aria-label="필터 펼치기"><span class="filter-collapse-icon" aria-hidden="true">▲</span> 필터 펼치기</button>
        <button type="button" id="btn-guide" class="secondary">가이드</button>
        <button type="button" id="btn-reset">Reset</button>
      </div>
    </header>
    <aside id="left-sidebar">
      <div class="left-sidebar-title">Menu</div>
      <nav id="left-nav" aria-label="주요 메뉴">
        <a href="#" class="active">Overview</a>
        <a href="#">Data Quality</a>
        <a href="#">Advanced</a>
      </nav>
      <div id="treemap-desc-popup" class="treemap-desc-popup" style="display:none;" aria-label="트리맵 설명">
        <div class="treemap-desc-popup-title" id="treemap-desc-drag">트리맵 설명 <span class="treemap-desc-toggle" id="treemap-desc-toggle" aria-label="접기">−</span></div>
        <div class="treemap-desc-popup-body" id="left-treemap-desc"></div>
        <div class="treemap-desc-popup-resize" id="treemap-desc-resize" aria-label="크기 조절"></div>
      </div>
    </aside>
    <main id="main">
      <div id="main-overview" class="main-view">
      <div id="metric-row" class="metric-row">
        <span id="data-row-count" class="data-row-count" aria-label="표시 데이터 건수">표시 데이터: —</span>
        <div class="metric-row-actions">
          <button type="button" id="btn-line-single" class="btn-data-table btn-toggle" title="연결률 시계열 합쳐보기/나눠보기" aria-pressed="false">합쳐보기</button>
          <button type="button" id="btn-pivot-card" class="btn-data-table">데이터테이블 보기</button>
        </div>
      </div>
      <div id="interpretation-card" class="interpretation-card" aria-label="데이터 해석"><span class="interpretation-hint">차트 막대를 <strong>클릭</strong>하면 드릴다운됩니다. 우측 필터에서 지역·제품군을 선택하면 해당 단계가 아래에 표시됩니다.</span></div>
      <div id="kpi-cards">
        <div class="kpi-card kpi-card-metric" data-metric="sales" role="button" tabindex="0"><span class="kpi-label">판매</span><span class="kpi-value" id="kpi-sales">—</span><span class="kpi-click">click</span></div>
        <div class="kpi-card kpi-card-metric" data-metric="smart_sales" role="button" tabindex="0"><span class="kpi-label">스마트 판매</span><span class="kpi-value" id="kpi-smart-sales">—</span><span class="kpi-click">click</span></div>
        <div class="kpi-card kpi-card-metric" data-metric="connected" role="button" tabindex="0"><span class="kpi-label">연결대수</span><span class="kpi-value" id="kpi-connected">—</span><span class="kpi-click">click</span></div>
        <div class="kpi-card"><span class="kpi-label">스마트 판매 비율</span><span class="kpi-value" id="kpi-smart-sales-rate">—</span></div>
        <div class="kpi-card"><span class="kpi-label">연결률</span><span class="kpi-value" id="kpi-connected-rate">—</span></div>
      </div>
      <div class="chart-section">
        <h4 class="chart-title">연결률 (시계열)</h4>
        <div class="chart-container chart-line-wrap" id="line-chart" style="height:220px;"></div>
      </div>
      <div id="monitor" class="monitor-two-cols">
        <div class="chart-section">
          <h4 class="chart-title" id="chart-title-region">지역별</h4>
          <div class="chart-container chart-bar-wrap" id="bar-chart-region"></div>
        </div>
        <div class="chart-section">
          <h4 class="chart-title" id="chart-title-product">제품군별</h4>
          <div class="chart-container chart-bar-wrap" id="bar-chart-product"></div>
        </div>
      </div>
      </div>
      <div id="main-advanced" class="main-view" style="display:none;">
        <header class="treemap-header" role="toolbar" aria-label="트리맵 설정">
          <span class="treemap-header-title">Treemap</span>
          <div class="treemap-header-row">
            <div class="treemap-field">
              <span class="treemap-field-label">Root</span>
              <div class="treemap-axis-btns" id="adv-rootmode-toggle">
                <button type="button" id="adv-rootmode-region" class="treemap-axis-btn active" aria-pressed="true">Region</button>
                <button type="button" id="adv-rootmode-product" class="treemap-axis-btn" aria-pressed="false">Product</button>
              </div>
            </div>
            <div class="treemap-field">
              <label for="adv-size-metric-select" class="treemap-field-label">Size</label>
              <select id="adv-size-metric-select" class="treemap-field-control" aria-label="Size Metric">
                <option value="sales_count">sales_count</option>
                <option value="smart_sales_count">smart_sales_count</option>
                <option value="connected_count">connected_count</option>
                <option value="device_count">device_count</option>
              </select>
            </div>
            <div class="treemap-field">
              <label for="adv-color-metric-select" class="treemap-field-label">Color</label>
              <select id="adv-color-metric-select" class="treemap-field-control" aria-label="Color Metric">
                <option value="installation_rate_pct">installation_rate_pct</option>
                <option value="connection_rate_pct">connection_rate_pct</option>
              </select>
            </div>
            <div class="treemap-field treemap-preset-inline">
              <span class="treemap-field-label">Preset</span>
              <div class="treemap-preset-btns">
                <button type="button" id="adv-preset-region-sales" class="treemap-axis-btn" title="Region-first + 판매">R·판매</button>
                <button type="button" id="adv-preset-region-conn" class="treemap-axis-btn" title="Region-first + 연결">R·연결</button>
                <button type="button" id="adv-preset-region-rate" class="treemap-axis-btn" title="Region-first + 연결률">R·연결률</button>
                <button type="button" id="adv-preset-product-sales" class="treemap-axis-btn" title="Product-first + 판매">P·판매</button>
              </div>
            </div>
            <div class="treemap-field treemap-field-meta">
              <span id="adv-area-scale-label" class="treemap-field-value">none</span>
              <span id="adv-quality-badge" class="adv-quality-badge" aria-live="polite">—</span>
            </div>
          </div>
          <div class="treemap-header-row treemap-header-legacy" aria-hidden="true">
            <div class="treemap-field">
              <label for="treemap-metric" class="treemap-field-label">메트릭(레거시)</label>
              <select id="treemap-metric" class="treemap-field-control">
                <option value="sales">판매</option>
                <option value="smart_sales">스마트 판매</option>
                <option value="connected">연결대수</option>
              </select>
            </div>
            <div class="treemap-field">
              <label for="treemap-color-metric" class="treemap-field-label">색상(레거시)</label>
              <select id="treemap-color-metric" class="treemap-field-control">
                <option value="connected_rate_pct">연결률</option>
                <option value="smart_sales_rate_pct">스마트 판매 비율</option>
              </select>
            </div>
            <div class="treemap-field treemap-field-axis">
              <span class="treemap-field-label">레이블축</span>
              <div class="treemap-axis-btns">
                <button type="button" id="treemap-axis-region" class="treemap-axis-btn active" aria-pressed="true">지역</button>
                <button type="button" id="treemap-axis-product" class="treemap-axis-btn" aria-pressed="false">제품군</button>
              </div>
            </div>
          </div>
        </header>
        <div class="treemap-chart-wrap">
          <div id="advanced-treemap-container" class="treemap-container"></div>
          <p class="treemap-hint" aria-hidden="true">휠: 확대/축소 · 드래그: 이동</p>
          <div id="treemap-legend" class="treemap-legend treemap-legend-mini" aria-label="색상 스케일">
            <div class="treemap-legend-title"></div>
            <div class="treemap-legend-bar-wrap">
              <span class="treemap-legend-label treemap-legend-min">0%</span>
              <div class="treemap-legend-bar"></div>
              <span class="treemap-legend-label treemap-legend-max">100%</span>
            </div>
          </div>
        </div>
      </div>
    </main>
    <aside id="right-column">
      <div id="right-panel">
        <div class="filter-panel-header">
          <h3 class="filter-panel-title">필터</h3>
        </div>
        <div class="filter-block filter-period">
          <label>기간</label>
          <div class="period-inputs">
            <select id="filter-period-start" aria-label="시작월"></select>
            <span>~</span>
            <select id="filter-period-end" aria-label="종료월"></select>
          </div>
        </div>
        <div class="filter-block filter-period-unit">
          <label for="filter-period-unit">Period Unit</label>
          <select id="filter-period-unit" aria-label="Period Unit">
            <option value="month">Month</option>
          </select>
        </div>
        <div class="filter-block filter-global-reset">
          <button type="button" id="btn-drill-reset" class="btn-global-view" title="지역·제품군 드릴다운 해제">글로벌 보기</button>
        </div>
        <div class="filter-block">
          <label>지역</label>
          <div id="filter-region-list" class="filter-list"></div>
        </div>
        <div class="filter-block">
          <label>제품군</label>
          <div id="filter-product-list" class="filter-list"></div>
        </div>
        <div id="adv-right-panel" class="adv-right-panel" style="display:none;" aria-label="Treemap 정보">
          <div class="filter-panel-header"><h3 class="filter-panel-title">Treemap 정보</h3></div>
          <div id="adv-breadcrumb" class="adv-breadcrumb"></div>
          <div id="adv-selection-stats" class="adv-selection-stats"></div>
          <div id="adv-top-bottom" class="adv-top-bottom">
            <h4>동일 레벨 Top / Bottom</h4>
            <div id="adv-top-list"></div>
            <div id="adv-bottom-list"></div>
          </div>
          <div id="adv-quality-summary" class="adv-quality-summary"></div>
        </div>
      </div>
      <div id="filter-expand-slot" class="filter-expand-slot" aria-hidden="true"></div>
    </aside>
  </div>

  <div id="guide-overlay" class="guide-overlay" aria-hidden="true">
    <div class="guide-card">
      <div class="guide-progress"><span id="guide-step-num">1</span> / <span id="guide-step-total">4</span></div>
      <p id="guide-message" class="guide-message">1단계: 우측 필터에서 <strong>지역</strong> 버튼을 클릭해 보세요.</p>
      <div class="guide-actions">
        <button type="button" id="guide-skip">건너뛰기</button>
        <button type="button" id="guide-next">다음</button>
      </div>
    </div>
    <div id="guide-spotlight" class="guide-spotlight"></div>
  </div>

  <div id="pivot-overlay" aria-hidden="true">
    <div id="pivot-drawer">
      <div class="pivot-header">
        <span class="pivot-title">Pivot 테이블</span>
        <button type="button" id="btn-pivot-close" class="pivot-close-btn" aria-label="닫기">×</button>
      </div>
      <div class="body">
        <div class="pivot-toolbar">
          <label for="pivot-region-depth">지역 차원</label>
          <select id="pivot-region-depth" aria-label="지역 차원 단계 (상위부터 하위 순)">
            <option value="1">1단계(지역)</option>
            <option value="2">2단계(지역+법인)</option>
            <option value="3">3단계(지역+법인+국가)</option>
          </select>
          <label for="pivot-product-depth">제품 차원</label>
          <select id="pivot-product-depth" aria-label="제품 차원 단계 (상위부터 하위 순)">
            <option value="1">1단계(L1)</option>
            <option value="2">2단계(L1+L2)</option>
            <option value="3">3단계(L1+L2+L3)</option>
          </select>
        </div>
        <p class="pivot-caption">행 차원: 지역(1~3단계) · 열 차원: 제품군(1~3단계) · Metric: <span id="pivot-metric-label">판매량</span></p>
        <table id="pivot-table" class="pivot-table-compact">
          <thead>
            <tr id="pivot-thead-row">
              <th>지역</th><th>제품군</th>
              <th class="numeric" data-sort="sales">판매량</th>
              <th class="numeric" data-sort="smart_sales">스마트 판매량</th>
              <th class="numeric" data-sort="connected">연결 수</th>
              <th class="numeric" data-sort="smart_sales_rate_pct">스마트 판매 비율</th>
              <th class="numeric" data-sort="connected_rate_pct">연결률</th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr>
              <td id="pivot-tfoot-summary" colspan="2">합계</td>
              <td class="numeric" id="pivot-total-sales">0</td>
              <td class="numeric" id="pivot-total-smart-sales">0</td>
              <td class="numeric" id="pivot-total-connected">0</td>
              <td class="numeric" id="pivot-total-smart-rate">—</td>
              <td class="numeric" id="pivot-total-connected-rate">—</td>
            </tr>
          </tfoot>
        </table>
        <div class="pivot-pagination-wrap">
          <div class="pivot-pagination">
            <button type="button" id="pivot-prev">이전</button>
            <span id="pivot-page-info" class="pivot-page-info">1 / 1</span>
            <button type="button" id="pivot-next">다음</button>
          </div>
          <div class="pivot-page-size">
            <label>페이지당</label>
            <select id="pivot-page-size" aria-label="페이지당 행 수">
              <option value="20">20줄</option>
              <option value="50">50줄</option>
              <option value="100">100줄</option>
            </select>
          </div>
        </div>
        <div id="self-check-panel">
          <h4>Self-check</h4>
          <button type="button" id="btn-self-check">체크 실행</button>
          <div id="self-check-results"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <script src="js/hierarchy.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
