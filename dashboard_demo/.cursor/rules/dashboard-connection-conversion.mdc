---
description: Connection Conversion Monitoring 대시보드 — 통합 규칙 (목적·데이터·구현·레이아웃·테마)
globs: ["**/dashboard_demo/**"]
alwaysApply: false
---

# Connection Conversion Monitoring — 통합 규칙 (단일 소스)

이 파일은 **docs/** 내 md, **README.md**, **agent.md** 내용을 통합한 단일 규칙이다.  
대시보드 수정·검증 시 **이 규칙을 우선** 적용한다.

---

## 1. 규칙 우선순위 (확인)

- **.cursor/rules** 에 있는 규칙은 Cursor가 AI 지시로 사용한다.
- **docs/** 폴더의 md는 참조용 문서이며, 규칙으로 자동 주입되지 않는다.
- **결론:** 이 파일(.cursor/rules/dashboard-connection-conversion.mdc)이 **docs보다 우선 적용**된다. 충돌 시 이 규칙을 따른다.
- 기존 agent.md, docs/DASHBOARD_GOALS.md, docs/DATA_SPEC.md 등은 보조 참조용으로만 사용하고, 이 문서와 **중복·충돌**이 있으면 **이 문서 기준**으로 한다.

---

## 2. 목적·차원·데이터

### 2.1 목적
- **글로벌/지역/법인/국가**, **제품군/제품** 단위 KPI 모니터링.
- 사용자가 필터·드릴다운으로 "어디서, 어떤 제품에서, 어떤 수치가 나왔는지" 파악.

### 2.2 데이터 소스
- **기본:** data/monthly_kpi.csv (year_month, region, entity, country, product_group, sales, smart_sales, connected, smart_sales_rate_pct, connected_rate_pct).
- 선택: data/region_entity_country.json, data/product_hierarchy.json 으로 라벨 보강.
- 더미(채널A~E) 사용 금지.

### 2.3 주요 KPI 5개 (필수 표시)
| KPI(한글) | 필드명 | 단위 |
|-----------|--------|------|
| 판매 | sales | 대 |
| 스마트 판매 | smart_sales | 대 |
| 연결대수 | connected | 대 |
| 스마트 판매 비율 | smart_sales_rate | % |
| 연결률 | connected_rate | % |

### 2.4 차원
- **지역(region)** / 법인(entity) / 국가(country)
- **제품군(product_group)** / 제품

---

## 3. 시각화 레이아웃 (필수)

다음 구조를 **반드시** 따른다. 이와 다르면 "이상한 결과"로 간주한다.

1. **상단: KPI 카드**
   - 판매·스마트 판매·연결대수·스마트 판매 비율·연결률 **5개를 카드 형태**로 표시.
   - 한 줄 텍스트가 아니라 **카드(박스) 단위**로, 각 카드에 라벨 + 값.

2. **그 다음: 연결률 라인 차트**
   - **연결률(connected_rate, %)** 의 **시계열(월별)** 라인 차트 **1개**.
   - **차트 라이브러리:** Apache ECharts 5.4.x 사용. X축(월), Y축(%), **포인트별 숫자 표기** 필수.

3. **그 다음 줄: 2열 차트 (가로 막대)**
   - **왼쪽 열:** **지역(region)** **가로 막대 차트** (AMER, EMEA, APAC 등 — Y축에 지역명, X축에 값).
   - **오른쪽 열:** **제품군(product_group)** **가로 막대 차트** (REF, WSH 등 — Y축에 제품군명, X축에 값).
   - ECharts bar: `xAxis: { type: 'value' }`, `yAxis: { type: 'category', data: [...] }`, `series: [{ type: 'bar' }]`.

---

## 4. 테마

- **기본 테마:** Pico CSS 1.5.x 또는 동등한 기본 테마 적용. (docs/TECH_STACK.md 참조.)
- **화이트 톤, 심플.** 배경: 밝은 배경. 텍스트: 진한 회색/검정. 보더: 얇은 회색 선.
- 다크 테마(#1a1a2e, #0f0f1a 등) 사용 금지.

---

## 5. 색상 (COLOR_MAP)

메트릭별 색상은 아래만 사용한다. 막대·라인·강조에 적용.

- sales: **#0F766E**
- connected: **#B45309**
- smart_sales: **#2563EB**
- conn_rate: **#1428A0**
- smart_conn_rate: **#7C3AED**

- state.metric 변경 시 **setThemeByMetric(metric)** 호출, CSS 변수 **--metricColor**, **--metricColorSoft** 적용.

---

## 6. 표기 규칙

- 비율: **"64.4%"** 형태.
- 절대값: **"162,936"** 형태 (toLocaleString).
- 차트: 막대 상단 또는 라인 끝에 **포맷된 라벨** 표시.

---

## 7. 배포·기술 제약

- 로컬 **file://** 실행 가능. HTML + css/dashboard.css + js/app.js 분리.
- **차트:** Apache ECharts 5.4.3 (CDN 또는 로컬 vendor). **의존성 1개:** echarts@5.4.3.
- **기본 테마:** Pico CSS 1.5.x (CDN 또는 로컬). 선택 적용 후 dashboard.css로 오버라이드.
- 해상도: 1920×1080, 뷰포트 높이 약 960px 가정.

---

## 8. 필수 DOM·동작 (요약)

- **KPI:** kpi-sales, kpi-smart-sales, kpi-connected, kpi-smart-sales-rate, kpi-connected-rate (카드 컨테이너 id: kpi-strip 또는 kpi-cards).
- **차트:** ECharts 사용. **line-chart** div(연결률 시계열, X/Y축·포인트 라벨), **bar-chart-region** div(지역 **가로 막대**), **bar-chart-product** div(제품군 **가로 막대**). monitor 영역은 **2열** 그리드(지역 | 제품).
- **필터:** 우측 패널 **접기/펼치기** 가능(btn-toggle-panel, #right-panel.collapsed). **필터 항목:** #filter-region-list, #filter-product-list에 지역·제품군 항목이 정상 렌더되어야 함. Self-check에 "필터 지역 항목 존재", "필터 제품군 항목 존재" 체크 포함.
- **선택/필터:** selection, filterRegion, filterProductGroup, drillStack, Back/Pivot/Reset.
- **클릭:** Bar 클릭=필터, Shift+클릭/더블클릭=드릴. "Click: Filter · Shift/Double: Drill" 힌트 유지.
- **Pivot:** pivot-table, 5 KPI 컬럼, 합계 행, 페이징, 정렬.
- **가드:** L1 가로 오버플로우 토스트, Render Guard(차트 미렌더 시 토스트), Self-check 패널(Pivot 내).

---

## 9. 검증 체크리스트 (R1~R7, L1~L5)

- **R1:** 로컬 분리 또는 단일 파일, file:// 동작, CDN 없음.
- **R2:** 1920×1080 가로 스크롤 없음, UI 겹침 없음, 차트 가독.
- **R3:** 메인 세로 스크롤 최소.
- **R4:** 우측 패널 접기/펼침 시 레이아웃 유지.
- **R5:** Bar 클릭=필터, Shift/Double=드릴, Back=drillStack 복원.
- **R6:** Pivot 열기/닫기, 테이블·페이징·정렬, 합계=KPI.
- **R7:** Cache pill HIT/MISS.
- **L1:** scrollWidth ≤ clientWidth+1, 위반 시 토스트.
- **L2~L5:** min-height:0, main 높이, 우측 접어도 차트 유지, SVG viewBox, body overflow hidden.

---

## 10. 중복·충돌 정리

- **단일 HTML vs 분리:** 통합 규칙은 **로컬 분리(HTML+CSS+JS) 허용**. 단일 파일 배포는 별도 산출물로 둠.
- **agent.md "cohortSvg, geoSvg, prodSvg" 등:** 이 규칙의 **§3 시각화 레이아웃**이 우선. 즉, **KPI 카드 + 연결률 라인 + 2열(지역 바 | 제품 바)** 로 통일.
- **agent.md 필수 DOM id:** contextLine, chips, geoSearch 등은 현재 구현과 다를 수 있음. **§8 필수 DOM**을 우선 적용하고, 기존 id는 호환되는 범위에서 유지.

이 문서를 수정할 때는 docs/ 내 해당 내용도 동기화하는 것을 권장한다.
